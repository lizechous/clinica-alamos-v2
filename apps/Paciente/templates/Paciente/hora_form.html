{% extends 'base.html' %} 
{% load static %} 
<!--Main Header-->
{% block main%}

<!--End Main Header -->

<!--Page Title-->
<section class="page-title text-center" style="background-image:url( {% static 'images/background/3.jpg' %});">
    <div class="container">
        <div class="title-text">
            <h1>Agenda tu hora</h1>
            <ul class="title-menu clearfix">
                <li>
                    <a href="index.html">Inicio &nbsp;/</a>
                </li>
                <li>Agenda tu hora</li>
            </ul>
        </div>
    </div>
</section>
<!--End Page Title-->
{% endblock %}

{% block javascript %}
  <script>

    {% comment %} $(function() {
        $("#id_run").rut().on('rutValido', function(e, rut, dv) {
        }, { minimumLength: 7,  maximumLength: 9} );
    }) {% endcomment %}

    $('#id_run').Rut({
        on_error: function(){ $('#id_run')[0].setCustomValidity('rut invalido !'); },
        on_success: function(){ $('#id_run')[0].setCustomValidity(''); },
        format_on: 'keyup'
    });

    $( function() {
        $('#id_hora_cita').timepicker({
            'timeFormat': 'H:i',
            'step': '45',
            'minTime': '8:00',
            'maxTime': '18:00',
        } );
    } );
    
    $( function() {
        $( "#id_fecha_cita" ).datepicker(
            {
                'dateFormat': 'dd/mm/yy'
            }
        );
    } );

    $("#id_especialidad").change(function () {
      var id_especialidad = $(this).val();

      $.ajax({
        url: '/especialidad/get_especialidades',
        data: {
          'id_especialidad': id_especialidad
        },
        dataType: 'json',
        success: function (data) {
            // obtengo el elemento select (lista desplegable de medicos)
            var select = document.getElementById('medico');
            // le quito la cualidad de deshabilitado
            select.removeAttribute("disabled");
            // borro todos sus elementos para agregar los médicos de la especialidad consultada
            select.length = 0;
            // convierto la respuesta de medicos a json
            var dataMedicos = jQuery.parseJSON(data)
            // recorro cada uno de los médicos obtenidos para agregarlos como opción en el select
            dataMedicos.forEach(function(value) {
              // creo una opción de select
              var opt = document.createElement('option');
              // agrego el nombre de la opción, en este caso el nombre del médico
              opt.innerHTML = value.fields.nombre_medico;
              // agrego como valor de opción la pk del médico (importante para luego hacer el insert)
              opt.value = value.pk;
              // agrego la opción creada al select de médicos
              select.appendChild(opt);
            });
        }
      });
    });

  </script>
{% endblock %}

{% block content %}
<!-- Contact Section -->
<section class="blog-section section style-three pb-0">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-12 col-xs-12">
                <div class="contact-area style-two">
                    <div class="section-title">
                        <h3>Agenda tu hora médica</h3>
                    </div>
                    <form name="contact_form" class="default-form contact-form" action="" method="post">
                        <div class="row">
                            <div class="col-md-12 col-sm-12 col-xs-12">
                                <div class="form-group">
                                <form method="POST">
                                    {% csrf_token %} 
                                    {{ form.as_p }}
                                    <br>
                                    <button type="submit">Reservar hora</button>
                                </form>
                                </div>                       
                            </div>
                        </div>
                    </form>
                </div>                      
            </div>
            <div class="col-md-6 col-sm-12 col-xs-12">
                <div class="appointment-image-holder">
                    <figure>
                        <img src="{% static 'images/background/appoinment.jpg' %}" alt="Appointment">
                    </figure>
                </div>                       
            </div>
        </div>                    
    </div>
</section>
<!-- End Contact Section -->
{% endblock %}